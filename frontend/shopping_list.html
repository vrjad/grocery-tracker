<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weekly Shopping List</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #333;
    }

    h1 {
      margin-top: 30px;
      font-size: 3rem;
      color: #fff;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
    }

    h2 { margin-top: 20px; }

    table, form {
      background: rgba(255,255,255,0.95);
      padding: 20px;
      margin-top: 15px;
      border-radius: 12px;
      box-shadow: 0 8px 15px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 800px;
    }

    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #f5f5f5; }
    .low { color: red; }

    input[type="text"], input[type="number"] { padding: 6px; border-radius: 6px; border: 1px solid #ccc; }
    button {
      padding: 10px 20px;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 6px 10px rgba(0,0,0,0.2);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px rgba(0,0,0,0.3);
    }

    .top-buttons { display: flex; gap: 15px; justify-content: flex-end; margin-top: 10px; width: 90%; max-width: 800px; }
    @media(max-width:600px){ form,table{width:95%;} }
  </style>
</head>
<body>
  <h1>üõí Weekly Shopping List</h1>

  <div class="top-buttons">
    <a href="/home.html"><button>üè† Home</button></a>
    <button onclick="fetchShoppingList()">Refresh List</button>
  </div>

  <h2>Auto Items (Low Stock)</h2>
  <table id="autoTable">
    <thead><tr><th>Name</th><th>Current Qty</th><th>Max Qty</th><th>Suggested to Buy</th></tr></thead>
    <tbody></tbody>
  </table>

  <h2>Manual Shopping List</h2>
  <form id="manualForm" onsubmit="return addManual(event)">
    <label>Item Name: <input type="text" id="manualName" required></label>
    <label>Qty: <input type="number" id="manualQty" step="0.1" value="1"></label>
    <label>Regular: <input type="checkbox" id="manualRegular"></label>
    <button type="submit">Add to List</button>
  </form>

  <table id="manualTable">
    <thead><tr><th>Name</th><th>Qty</th><th>Regular</th><th>Status</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    async function fetchShoppingList() {
      const res = await fetch('http://127.0.0.1:5000/api/shopping-list');
      const data = await res.json();

      const autoBody = document.querySelector('#autoTable tbody');
      autoBody.innerHTML = '';
      data.auto.forEach(it=>{
        autoBody.innerHTML += `<tr class="low">
          <td>${it.name}</td>
          <td>${it.current_qty}</td>
          <td>${it.max_qty}</td>
          <td>${it.suggested_qty}</td>
        </tr>`;
      });

      const manualBody = document.querySelector('#manualTable tbody');
      manualBody.innerHTML = '';
      data.manual.forEach(m=>{
        manualBody.innerHTML += `<tr>
          <td>${m.name}</td>
          <td>${m.qty}</td>
          <td>${m.regular?'‚úÖ':''}</td>
          <td><button onclick="markBought(${m.id})">Mark Bought</button></td>
        </tr>`;
      });
    }

    async function addManual(event){
      event.preventDefault();
      const data={
        name: document.getElementById('manualName').value,
        qty: parseFloat(document.getElementById('manualQty').value),
        regular: document.getElementById('manualRegular').checked
      };
      const res = await fetch('http://127.0.0.1:5000/api/manual-add',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(data)
      });
      if(res.ok){
        alert('Manual item added!');
        document.getElementById('manualForm').reset();
        fetchShoppingList();
      }
    }

    async function markBought(id){
      await fetch('http://127.0.0.1:5000/api/mark-bought',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({manual_id:id})
      });
      fetchShoppingList();
    }

    fetchShoppingList();
  </script>
</body>
</html>
